openapi: 3.0.3
info:
  title: Emoji Renderer Service
  description: Text-to-Image/Animation rendering service for Misskey Custom Emojis.
  version: 1.0.0

paths:
  /health:
    get:
      summary: Health Check
      description: Returns the health status of the service.
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "ok"

  /fonts:
    get:
      summary: List available fonts
      description: Returns a list of installed fonts available for rendering. Service B (AI) should query this to know valid 'fontId' values.
      responses:
        '200':
          description: List of fonts
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                      description: The ID to send in the /generate request.
                      example: "noto_sans_jp_black"
                    name:
                      type: string
                      description: Human readable name.
                      example: "Noto Sans JP Black"
                    categories:
                      type: array
                      items:
                        type: string
                        enum: [serif, sans-serif, handwritten, display]

  /generate:
    post:
      summary: Generate Emoji Image
      description: Renders a static WebP or animated APNG based on strict parameters.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RenderRequest'
      responses:
        '200':
          description: Image generated successfully.
          content:
            image/webp:
              schema:
                type: string
                format: binary
            image/apng:
              schema:
                type: string
                format: binary
        '400':
          description: Bad Request (Logical error, e.g., text too long for canvas).
        '422':
          description: Validation Error (Invalid hex code, unknown font ID).
        '500':
          description: Rendering Engine Error.

components:
  schemas:
    RenderRequest:
      type: object
      required:
        - text
        - style
      properties:
        text:
          type: string
          description: The text content to render. Newlines (\n) are supported.
          example: "進捗\nどう？"
          maxLength: 20 # Performance safeguard
        
        layout:
          type: object
          description: Canvas sizing and text alignment.
          properties:
            mode:
              type: string
              enum: [square, banner]
              default: banner
              description: 'square: 256x256 fixed. banner: height 256, width dynamic.'
            alignment:
              type: string
              enum: [left, center, right]
              default: center

        style:
          type: object
          required:
            - fontId
            - textColor
          properties:
            fontId:
              type: string
              description: Must match an ID returned by /fonts.
              example: "noto_sans_jp_black"
            textColor:
              type: string
              pattern: '^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$'
              example: "#FF0000"
            outlineColor:
              type: string
              pattern: '^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$'
              default: "#FFFFFF"
            outlineWidth:
              type: integer
              minimum: 0
              maximum: 20
              default: 0
            shadow:
              type: boolean
              default: false

        motion:
          type: object
          description: Animation settings. If omitted or type is 'none', output is static WebP.
          properties:
            type:
              type: string
              enum: [none, shake, spin, bounce, gaming]
              default: none
            intensity:
              type: string
              enum: [low, medium, high]
              default: medium
              description: Affects amplitude of shake/bounce or speed of spin.
            speed:
              type: number
              minimum: 0.1
              maximum: 5.0
              default: 1.0
              description: Multiplier for the animation duration.